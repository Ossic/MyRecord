# 理解RESTful架构

REST（英文：Representational State Transfer，又称具象状态传输）是 Roy Thomas Fielding 博士于 2000 年在他的博士论文中提出来的一种**万维网软件（可理解为 Web 应用）架构风格**，目的是**便于不同软件/程序在网络（例如互联网）中互相传递信息。**

目前在三种主流的 Web 服务实现方案中，因为 REST 模式与复杂的 SOAP 和 XML-RPC 相比更加简洁，越来越多的 web 服务开始采用 REST 风格设计和实现。

例如，Amazon.com 提供接近 REST 风格的 Web 服务执行图书查询；雅虎提供的 Web 服务也是 REST 风格的。

RESTful 架构，就是目前最流行的一种互联网软件架构。它结构清晰、符合标准、易于理解、扩展方便，所以正得到越来越多网站的采用。

>   Fielding 是一个非常重要的人，他是 HTTP 协议（1.0 版和 1.1 版）的主要设计者、Apache 服务器软件的作者之一、Apache 基金会的第一任主席。
>
>   所以，他的这篇论文一经发表，就引起了关注，并且立即对互联网开发产生了深远的影响。

## 命名

**如果一个架构符合 REST 原则，就称它为 RESTful 架构。**

在了解它的原则之前，先来看看这几个词到底表示什么意思，REST 的名称直译就是 "表现层状态转化" ，这是什么玩意，根本听不懂，它其实省略了主语。"表现层"其实指的是"资源"（Resources）的"表现层"。

-   **资源（Resources）**

    这个还是比较好理解的，我们平时上网就是在不停的访问资源嘛~~前面也是说过 URI（统一资源定位符）的，互联网上的每一种资源都可以对应一个特定的 URL。

    所谓"上网"，就是与互联网上一系列的"资源"互动，调用它的 URI。

-   **表现层（Representation）**

    "资源"是一种信息实体，它可以有多种外在表现形式。我们把"资源"具体呈现出来的形式，叫做它的"表现层"（Representation）。

    举个栗子就是一段字符可以表现为 txt、HTML、XML、JSON；一幅图片可以是 JPEG、GIF、PNG；

    URL 来确定这个实体（资源），它的具体表现形式，应该在 HTTP 请求的头信息中用 Accept 和 Content-Type 字段指定，这两个字段才是对"表现层"的描述。

-   **状态转化（State Transfer）**

    访问一个网站，就代表了客户端和服务器的一个互动过程。在这个过程中，势必涉及到数据和状态的变化。

    互联网通信协议 HTTP 协议，是一个无状态协议。这意味着，所有的状态都保存在服务器端。

    因此，如果客户端想要操作服务器，必须通过某种手段，让服务器端发生"状态转化"（State Transfer）。而这种转化是建立在表现层之上的，所以就是"表现层状态转化"。

    客户端用到的手段，只能是 HTTP 协议，它们分别对应四种基本操作：**GET用来获取资源，POST用来新建资源（也可以用于更新资源），PUT用来更新资源，DELETE用来删除资源**

## 要点及标准

需要注意的是，REST 是设计风格而**不是**标准。

REST通常基于使用 HTTP，URI，和 XML 以及 HTML 这些现有的广泛流行的协议和标准。

-   资源是由URI来指定。
-   对资源的操作包括获取、创建、修改和删除资源，这些操作正好对应HTTP协议提供的GET、POST、PUT和DELETE方法。
-   通过操作资源的表现形式来操作资源。
-   资源的表现形式则是XML或者HTML，取决于读者是机器还是人，是消费web服务的客户软件还是web浏览器。当然也可以是任何其他的格式。

REST 架构风格最重要的架构约束有6个：

-   客户-服务器（Client-Server）

    通信只能由客户端单方面发起，表现为请求-响应的形式。

- 无状态（Stateless）

    通信的会话状态（Session State）应该全部由客户端负责维护。

-   缓存（Cache）

    响应内容可以在通信链的某处被缓存，以改善网络效率。

-   统一接口（Uniform Interface）

    通信链的组件之间通过统一的接口相互通信，以提高交互的可见性。


-   分层系统（Layered System）

    通过限制组件的行为（即每个组件只能“看到”与其交互的紧邻层），将架构分解为若干等级的层。


-   按需代码（Code-On-Demand，可选）

    支持通过下载并执行一些代码（例如Java Applet、Flash或JavaScript），对客户端的功能进行扩展。

@Ivony 老师的一句话概括很精辟：
**URL 定位资源，用 HTTP 动词（GET,POST,DELETE,DETC）描述操作**

## 应用于Web服务

感觉这个才是用的最多的地方，**符合 REST 设计风格的 Web API 称为 RESTful API**。

它从以下三个方面资源进行定义：

-   直观简短的资源地址：URI，比如：http://example.com/resources/。
-   传输的资源：Web服务接受与返回的互联网媒体类型，比如：JSON，XML，YAML等。
-   对资源的操作：Web服务在该资源上所支持的一系列请求方法（比如：POST，GET，PUT或DELETE）。

典型应用：

| 资源                                       | GET                                      | PUT                           | POST                                     | DELETE       |
| ---------------------------------------- | ---------------------------------------- | ----------------------------- | ---------------------------------------- | ------------ |
| 一组资源的URI，比如`http://example.com/resources/` | **列出**URI，以及该资源组中每个资源的详细信息（后者可选）。        | 使用给定的一组资源**替换**当前整组资源。        | 在本组资源中**创建/追加**一个新的资源。该操作往往返回新资源的URL。    | **删除**整组资源。  |
| 单个资源的URI，比如`http://example.com/resources/142` | **获取**指定的资源的详细信息，格式可以自选一个合适的网络媒体类型（比如：XML、JSON等） | **替换/创建**指定的资源。并将其追加到相应的资源组中。 | 把指定的资源当做一个资源组，并在其下**创建/追加**一个新的元素，使其隶属于当前资源。 | **删除**指定的元素。 |

## REST的优点

-   可更高效利用缓存来提高响应速度
-   通讯本身的无状态性可以让不同的服务器的处理一系列请求中的不同请求，提高服务器的扩展性
-   浏览器即可作为客户端，简化软件需求
-   相对于其他叠加在 HTTP 协议之上的机制，REST的软件依赖性更小
-   不需要额外的资源发现机制
-   在软件技术演进中的长期的兼容性更好

## 误区

最常见的一种设计错误，就是 URI 包含动词。因为"资源"表示一种实体，所以应该是名词，URI不应该有动词，且推荐用复数；动词应该放在HTTP协议中。

像 show 、transfer 这些词是不能出现在 URL 中的。

另一个设计误区，就是在 URI 中加入版本号（理解为**一种**资源的多种表现形式），版本号可以在 HTTP 请求头信息的 Accept 字段中进行区分

## 关于URL

关于 URL 的组成，前辈给我们的经验是：

-   网络协议（http、https）
-   服务器地址
-   接口名称
-   ？参数列表

关于 URL 定义的限定：

-   不要使用大写字母
-   使用中划线（-）代替下划线（_）
-   参数列表应该被 encode 过

## 响应设计

Content Body 仅仅用来传输数据（曾经我们经常搞个状态码，它不是数据，这样是不符合规范的）。

数据要做到拿来就可用的原则，不需要进行拆箱的操作。

用来描述数据或者请求的元数据放在 header 中。

## 参考

http://www.ruanyifeng.com/blog/2011/09/restful.html