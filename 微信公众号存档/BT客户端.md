# BT客户端

上一篇对 BT 相关的内容说的太浅了，这次就补上，主要是学会使用/看懂 BT 客户端，在这之前需要了解一个很重要的概念 DHT 协议，可以说它救了BT....

## 关于Tracker服务器

上一篇中也是提到的，**Tracker 服务器**对于前期 BT 下载来说是非常重要的存在，首先来看下下载的大体过程

>   首先，你从浏览器中找到你感兴趣的内容，下载相应的 torrent 文件。
>
>   然后，你用一个BT下载客户端软件，打开这个文件。
>
>   这时，客户端软件就会根据 torrent 文件中的网址，自动连接 Tracker 服务器，从它那里接收到其他正在下载该文件的人的网址名单。
>
>   下一步，软件就一一与名单上的网址取得联系，从他们那里获取文件的片段，直到整个下载完成。

可以看出 Tracker 服务器的重要性，要是连不上它，BT下载根本没法启动，因为你无从知道，找谁索要文件。就是由于这个原因，Tracker 服务器成为了版权组织打击的重点。

世界最大的BT下载网站海盗湾就是这样被干的.....Tracker服务器的网址是公开的，很容易找到它的所有者，逃都逃不掉。

## 去中心化-DHT协议

2002年，纽约大学的两个教授 Petar Maymounkov 和 David Mazières 发表了一篇论文，提出了一种真正去中心化的"点对点"下载模型，他们把它叫做 Kademlia 方法。

Emule 率先在软件中支持这种方法，KAD 网络就是这样来的。到了2005年，BT软件也开始跟进了。目前，所有主流的BT下载客户端软件都支持这种方法。在BT下载中，这被叫做 **DHT协议**（Distributed hash table，分布式哈希表）。

至于它的运作原理，可以参考：

>   每一台加入BT下载的计算机，都被称为一个节点（node），有一个自己的ID。这个ID是一个哈希函数值，通过对要分享的文件内容或它的元数据进行哈希运算而得到。
>
>   这就是说，如果两台计算机正在下载同一个文件，那么它们的ID应该是彼此相似的。于是，每一台计算机就通过寻找与自己相似的ID，来找到自己可以与之交换数据的其他节点。
>
>   DHT 协议的另一个巧妙之处在于，每一台计算机**只保留自己附近的一部分节点信息**。
>
>   因此，为了得到更多的节点信息，就必须采用接龙方式，在一个个节点之间跳跃，逐步得到全网的节点分布图。这种信息获取方式，就保证了整个网络没有单个的中心，即使一个节点下线了，依然可以通过其他节点来获取文件，**因此也就不需要Tracker服务器来告诉你，其他节点在什么地方了**。

显而易见的好处是，整个下载网络的可靠性提高了，每一个节点都是可以被替代的。

另一个好处是，审查变得更困难了，因为每次下载的路径都是不一样的，而且每个节点都是动态变化的，**导致实际上无法追踪谁在下载**。

此外，magnet URI 的产生，使其变的非常容易传播，因为它只是一个字符串，根本无法禁止。

### DHT是如何初始化的

在客户端启动的时候需要添加一个初始的 node 表，也就是现在在线的一些人，这些人可能并没有你要的文件，你只是通过他们做跳板找到你要的文件。

share和winny等日系的P2P共享程序初始时是要通过HTTP方式去下载一个node表。bt和电驴是自动储存你通过tracker或者电驴服务器连接到的peers来自己生成一个node表。

## 关于BT客户端

在下载 BT 的时候，客户端一般会显示一些属性信息，那就来简单的解释下

-   种子
    表示的是提供文件上传的服务器，就是已经下载完毕的用户
    一般是 `xx(xxx)` 的形式，括号外的数字表示能够连接到的数目（应该是做种者），括号内是总数
    比如你下载完毕后把任务删了，或者文件移动了，那么你最多只能算括号内的一员，不可能有人连上你
-   用户
    正在下载的，表示和上面类似
    括号外的数字表示能够连接到的人，括号内是总数（正在下载的总数）
-   健康度
    这个怎么算的没仔细研究，如果你是初始做种者，那种子最开始的健康度就是1
    也就是越高代表资源拥有者越多，如果低于1，那么说名没有人拥有完整的资源，这个就肯定没法下载全了
-   DHT
    上面详细介绍过了，一般开启后速度会更好，也更稳定，但是也会容易引来迅雷....
-   区块
    这个在做种的时候会让你选择，也就是文件会被分（切）为很多块，每一块的大小，这个一般由软件自动设置
    下载的时候也是按区块为最小单位下载

还有要说一下的是，所有的 BT客户端（迅雷除外）一般都会让分享率多的用户优先下载，也就是说，如果你限制了上传速度那么也就限制了下载速度，要有点分享精神嘛