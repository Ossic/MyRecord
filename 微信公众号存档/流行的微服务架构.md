# 流行的微服务架构

首先来介绍下什么是微服务：

**微服务是一个模糊的术语，通常指的是小型独立服务，共同组成一个应用程序。**

微服务 (Microservices) 是**一种软件架构风格**，它是以**专注于单一责任与功能**的小型功能区块 (Small Building Blocks) 为基础，**利用模组化的方式组合**出复杂的大型应用程序，**各功能区块使用与语言无关** (Language-Independent/Language agnostic) 的 **API** 集相互通讯。

2014年，Martin Fowler 与 James Lewis 共同提出了微服务的概念，定义了微服务是由以单一应用程序构成的小服务，自己拥有自己的行程与轻量化处理，服务依业务功能设计，**以全自动的方式部署，与其他服务使用 HTTP API 通讯**。同时服务会使用最小的规模的集中管理 (例如 Docker) 能力，服务可以用不同的编程语言与数据库等元件实作。

---

微服务是一种以业务功能为主的服务设计概念，每一个服务都具有自主运行的业务功能，对外开放不受语言限制的 API (最常用的是 HTTP)，应用程序则是由一个或多个微服务组成。

虽然使用一般的服务器虚拟化技术就能应用于微服务的管理，但容器技术 (Container Technology) 如 Docker 会更加地适合发展微服务的运算资源管理技术。

微服务架构由于每个模块是由单个程序组成，所以能够更方便的进行迭代，更适合我们常说的敏捷开发。

每个微服务仅关注于完成一件任务并很好地完成该任务，**技术栈中妥协更少**

## 特点&规划

为什么使用微服务架构来做？当然是有它的优点，主要的有：

- **团队独立**
- **只做一件事，并把它做好**
  微服务架构也类似于 Unix 哲学的原则，做一件事，把它做好
- **故障隔离**
  都要能够自主，并在其他服务发生错误时不受干扰

---

一个微服务架构的应用程序有下列特性：

- 每个服务都容易被取代。
- 服务是以能力来组织的，例如使用者界面、前端、推荐系统、账单或是物流等。
- 由于功能被拆成多个服务，因此可以由不同的编程语言、数据库实作。
- 架构是对称而非分层（即生产者与消费者的关系）。

一个微服务架构：

- 适用于具持续交付 (Continuous Delivery) 的软件开发流程。
- 与服务导向架构 (Service-Oriented Architecture) 不同，后者是整合各种业务的应用程序，但微服务只属于一个应用程序。

---

数据库的规划：

- 每个服务都各有一个数据库，同属性的服务可共享同个数据库。
- 所有服务都共享同个数据库，但是不同表格，并且不会跨域存取。
- 每个服务都有自己的数据库，就算是同属性的服务也是，数据库并不会共享。

还有数据库的可弃性：将数据库作为短期的储存空间而不是储存长期的资料。这意味着数据库可以在离线时被清空。因为它们可以在上线时从事件存储中心恢复，因此也能以内存快取（如：Redis） 作为数据库服务器

## 优缺点

### 优点

- 每个服务都比较简单，只关注于一个业务功能。
- 微服务架构方式是松耦合的，可以提供更高的灵活性。
- 微服务可通过最佳及最合适的不同的编程语言与工具进行开发，能够做到有的放矢地解决针对性问题。
- 每个微服务可由不同团队独立开发，互不影响，加快推出市场的速度。
- 微服务架构是持续交付(CD)的巨大推动力，允许在频繁发布不同服务的同时保持系统其他部分的可用性和稳定性。

### 缺点

- 微服务的一些想法在实践上是好的，但当整体实现时也会呈现出其复杂性。
- 运维开销及成本增加：整体应用可能只需部署至一小片应用服务区集群，而微服务架构可能变成需要构建/测试/部署/运行数十个独立的服务，并可能需要支持多种语言和环境。
  这导致一个整体式系统如果由20个微服务组成，可能需要40~60个进程。
- 必须有坚实的 DevOps 开发运维一体化技能：开发人员需要熟知运维与投产环境，开发人员也需要掌握必要的数据存储技术如 NoSQL，具有较强 DevOps 技能的人员比较稀缺，会带来招聘人才方面的挑战。
- 隐式接口及接口匹配问题：把系统分为多个协作组件后会产生新的接口，这意味着简单的交叉变化可能需要改变许多组件，并需协调一起发布。在实际环境中，一个新品发布可能被迫同时发布大量服务，由于集成点的大量增加，微服务架构会有更高的发布风险。
- 代码重复：某些底层功能需要被多个服务所用，为了避免将“同步耦合引入到系统中”，有时需要向不同服务添加一些代码，这就会导致代码重复。
- 分布式系统的复杂性：作为一种分布式系统，微服务引入了复杂性和其他若干问题，例如网络延迟、容错性、消息序列化、不可靠的网络、异步机制、版本化、差异化的工作负载等，开发人员需要考虑以上的分布式系统问题。
- 异步机制：微服务往往使用异步编程、消息与并行机制，如果应用存在跨微服务的事务性处理，事务的实现更具挑战性，其实现机制会变得复杂化。
- 可测性的挑战：在动态环境下服务间的交互会产生非常微妙的行为，难以可视化及全面测试。经典微服务往往不太重视测试，更多的是通过监控发现生产环境的异常，进而快速回滚或采取其他必要的行动。但对于特别在意风险规避监管或投产环境错误会产生显著影响的场景下需要特别注意。

### 关于取舍

- 在合适的项目，合适的团队，采用微服务架构收益会大于成本。
- 微服务架构有很多吸引人的地方，但在拥抱微服务之前，也需要认清它所带来的挑战。
- 需要避免为了“微服务”而“微服务”。
- 微服务架构引入策略 – 对传统企业而言，开始时可以考虑引入部分合适的微服务架构原则对已有系统进行改造或新建微服务应用，逐步探索及积累微服务架构经验，而非全盘实施微服务架构。

## 其他问题

关于业务间的通信可以选择使用 HTTP/HTTPS （接口可作为 RESTful API），也可以选择使用 MQ 消息队列来实现，我个人是非常喜欢用消息队列的方式的，容错性好，还支持消息的持久化。

同步消息 REST

异步消息 – AMQP, STOMP, MQTT

消息格式 – JSON, XML, Thrift, ProtoBuf, Avro

关于通信问题这里面其实还可以搞很多的事情，消息代理、集群、API-网关、事件存储中心、讯息伫列等等

微服务架构确实是一种流行趋势，伴随它的流行 SpringBoot 也诞生了，是非常值得学习的。

## 参考

http://www.jianshu.com/p/de525753c9e8