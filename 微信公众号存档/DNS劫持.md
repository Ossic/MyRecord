## 什么是DNS劫持

>   DNS劫持就是通过劫持了DNS服务器，通过某些手段取得某域名的解析记录控制权，进而修改此域名的解析结果，导致对该域名的访问由原IP地址转入到修改后的指定IP，其结果就是对特定的网址不能访问或访问的是假网址，从而实现窃取资料或者破坏原有正常服务的目的。DNS劫持通过篡改DNS服务器上的数据返回给用户一个错误的查询结果来实现的。

所导致的直接后果就是你想访问的网站和实际返回的网站不一致，比如你想访问Google却返回的百度

## 什么是DNS污染

>   DNS污染是一种让一般用户由于得到虚假目标主机IP而不能与其通信的方法，是一种DNS缓存投毒攻击（DNS cache poisoning）。
>   其工作方式是：由于通常的DNS查询没有任何认证机制，而且DNS查询通常**基于的UDP是无连接不可靠的协议，因此DNS的查询非常容易被篡改**，**通过对UDP端口53上的DNS查询进行入侵检测，一经发现与关键词相匹配的请求则立即伪装成目标域名的解析服务器（NS，Name Server）给查询者返回虚假结果。**
>   用户访问一个地址，国内的服务器(非DNS,比如GFW)监控到用户访问的已经被标记地址时，服务器**伪装成DNS服务器**向用户发回错误的地址的行为。

导致的后果一般就是获得的是个不存在的IP啥的，反正就是死活打不开网页，比如你访问一些敏感网站

## 区别

简单说DNS劫持一般是DNS服务器发生了某种事故(被攻击)，返回了你错误的、可达到某种攻击者期望的结果

DNS污染就是监视到你的请求，一旦发现对应了相应的规则就干扰你

## 劫持后投放广告

一般而言，用户上网的DNS服务器都是运营商分配的，所以，在这个节点上，运营商可以为所欲为。

例如，访问http://jd.com，正常DNS应该返回京东的ip，而DNS劫持后，会返回一个运营商的中间服务器ip。

访问该服务器会一致性的返回302，让用户浏览器跳转到预处理好的带广告的网页，在该网页中再通过iframe打开用户原来访问的地址。

就是说为了避免广告代码给原网页带的影响，通常会把原有网站页面放置到一个和原页面相同大小的iFrame里面去，通过iFrame来隔离广告代码对原有页面的影响。

这就是为啥会看到页面上有很多的小窗口广告

## 解决

对于DNS劫持更换比较可靠的服务器即可，例如OpenDNS（208.67.222.222）或GoogleDNS（8.8.8.8）。

对于DNS污染，一般人是无能为力.....

## 补充

世界上的网站辣么多，并且还都是实时的在增加，一台DNS服务器不可能存储全部的路由表，如果用户访问一个网址本DNS服务器不知道，那就向上层查询，然后查询到后会缓存一定时间

但是这是基于上层服务器是可信的前提下，所以，如果对方发给你一个假的地址.....

至于世界范围的同步，也是如此，这里面牵扯到一个叫BGP的知识，我也没仔细看，就是用来保证服务器权威的吧，这样ISP之间才能安全的同步路由表