> 本文理解起来比较容易，只是进行简单的名词科普
>
> 来源：知乎，wiki等
>
> 最近比较忙，质量不要要求辣么高嘛~~

## CGI概述

> 通用网关接口（Common Gateway Interface/CGI）是一种重要的互联网技术，可以让一个客户端，从网页浏览器向执行在网络服务器上的程序请求数据。CGI描述了服务器和请求处理程序之间传输数据的一种标准~~(或者说是一种协议)~~

### 引子

其实我们在平常的浏览网页中就接触到了CGI，只是没意识到而已，就拿我们比较熟悉的动态网页来说，一个网站的动态内容肯定是**程序生成的**，那么，**这个程序就需要接受客户端的请求，然后进行相应处理，再返回给客户端**，客户端和服务端的通信当然是通过HTTP协议。

然后我们会发现，这个程序在处理客户端请求的时候，大部分时候会进行很多重复的工作，比如说HTTP请求的解析。也就是说，你的程序需要解析HTTP请求，我的程序也需要解析。

这样繁琐怎么行？效率还低，于是Web服务器诞生了。

> 注意：以下所说的都是CGI的工作模式

于是Web服务器可以解析这个HTTP请求，然后把这个请求的各种参数写进进程的`环境变量`，比如
`REQUEST_METHOD`，`PATH_INFO`之类的。之后呢，服务器会调用相应的程序来处理这个请求，这个程序也就是我们所要写的CGI程序了。

它(CGI程序)会负责生成动态内容，然后返回给服务器，再由服务器转交给客户端。服务器和CGI程序之间通信，**一般是通过进程的环境变量和管道。**

这样做虽然很清晰，但缺点就是每次有请求，服务器都会fork and exec，每次都会有一个新的进程产生，开销还是比较大的。

原因在与CGI程序是一个独立的程序，它是可以独立运行的（在提供HTTP请求的情况下），它可以用几乎所有语言来写，包括c，python，甚至shell脚本等等。所以对于一个程序，服务器只能以fork and exec的方式来调用它了。

## CGI脚本结构

1. 读取用户提交表单的信息(例子)
2. 处理这些信息（也就是实现业务）
3. 输出，返回html响应（返回处理完的数据）。

## Web服务器、CGI、PHP的关系

- **web服务器是用来接收HTTP请求并响应这个请求**
  通常在WEB开发中如果客户端发起请求给服务端，那么必须有WEB服务器，否则这个请求是没人收的。
- **CGI是运行在WEB服务器上的应用程序**
  这个程序的主要作用是用来处理用户的请求，可以用任意服务端语言实现（常见的如C，C++等），在早期的WEB开发中都是使用CGI来处理客户端请求的,**那时候还没有这种专为WEB开发而设计的语言如PHP**，不能够做到HTML代码和后台逻辑代码的分离，所以CGI程序返回的结果通常都会包含一些HTML代码，浏览器接收到整个结果然后进行渲染。
- **PHP脚本语言可以将前后端进行分离的WEB开发语言**
  PHP代码只负责处理后台逻辑，将大量的HTML代码放在静态HTML文件中，浏览器最后渲染的结果是服务器返回的HTML代码加JS代码加CSS代码以及PHP模板输出的综合结果。

综上：

- WEB服务器就是服务端代码运行的一个容器和环境；
- CGI就是早期的服务端应用程序，处理用户请求并直接输出浏览器能够识别的HTML代码；
- PHP是在CGI基础上发展起来的，主要用于WEB开发的，可以使前后端分离的一种开发语言。

## 另一种解释

CGI是一种通信协议，它把用户传递过来的数据转变成一个`k－v`的字典。这个字典中不光有用户的数据，还有HTTP协议的参数。它做的就是把数据，组织成一个固定结构形式的数据。方便任何符合CGI协议的程序都可以调用！

但是CGI不是负责通信（传输数据）的，通信的话是通过socket，也就是`server`，就是web服务器，之后调用CGI脚本，把数据转变成符合CGI协议的数据结构，用于后面的数据处理！

> @HeartSky 负责人都带头不写(￣^￣)